<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout/main}">

<head>
  <title th:text="#{admin.password.pageTitle}">
    Change Password - Admin Panel
  </title>
</head>

<body>

<div layout:fragment="content">

  <!-- CHANGE PASSWORD SECTION -->
  <section th:fragment="page-content" id="section-change-password" class="transition-colors duration-300">
    
    <!-- Page Header -->
    <h2 class="text-3xl font-bold mb-6 transition-colors duration-300" th:text="#{admin.password.title}">Change Password</h2>
    
    <!-- Main Content Container -->
    <div class="max-w-2xl">
      
      <!-- Password Change Form Card -->
      <div class="bg-light-bg-primary dark:bg-dark-bg-primary rounded-xl shadow-md p-6 transition-colors duration-300">
        
        <!--
          SUCCESS MESSAGE (from URL parameter)
          Displayed when password change is successful
        -->
        <div th:if="${param.success}"
             class="mb-6 bg-green-100 dark:bg-green-900/20 border border-green-400 dark:border-green-600 text-green-700 dark:text-green-400 px-4 py-3 rounded-lg transition-colors duration-300">
          <div class="flex items-center gap-2">
            <ion-icon name="checkmark-circle-outline" class="text-xl"></ion-icon>
            <span th:text="#{admin.password.success}">Password changed successfully!</span>
          </div>
        </div>

        <!--
          ERROR MESSAGE (from model)
          Displayed when validation fails or server error occurs
        -->
        <div th:if="${errorMessage}"
             class="mb-6 bg-red-100 dark:bg-red-900/20 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-400 px-4 py-3 rounded-lg transition-colors duration-300">
          <div class="flex items-center gap-2">
            <ion-icon name="alert-circle-outline" class="text-xl"></ion-icon>
            <span th:text="${errorMessage}">Error message</span>
          </div>
        </div>
  
        <!-- Current User Information Card -->
        <div class="mb-6 p-4 bg-light-action-secondary dark:bg-dark-action-secondary rounded-lg transition-colors duration-300">
          <div class="flex items-center gap-3">
            <!-- User avatar with initials -->
            <div class="w-12 h-12 bg-accent rounded-full flex items-center justify-center text-white font-bold text-lg transition-colors duration-300"
                 th:text="${currentUser?.initials} ?: 'AD'">
              HL
            </div>
            <div>
              <!-- User full name -->
              <p class="font-semibold transition-colors duration-300"
                 th:text="${currentUser?.name} ?: 'Hoang Luong Tran'">
                Hoang Luong Tran
              </p>
              <!-- User email -->
              <p class="text-sm text-light-fg-secondary dark:text-dark-fg-secondary transition-colors duration-300"
                 th:text="${currentUser?.email} ?: 'admin@devblog.com'">
                admin@devblog.com
              </p>
            </div>
          </div>
        </div>

        <!--
          CHANGE PASSWORD FORM
          Uses standard form POST for security (passwords should not be handled via HTMX)
        -->
        <form th:action="@{/admin/change-password}" method="post"
              id="changePasswordForm" class="space-y-6">
          
          <!-- CSRF Token (uncomment when using Spring Security) -->
          <!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/> -->
          
          <!-- CURRENT PASSWORD FIELD -->
          <div>
            <label for="currentPassword" class="block text-sm font-medium mb-2 transition-colors duration-300">
              <span th:text="#{admin.password.current}">Current Password</span> <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <!-- Lock icon -->
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <ion-icon name="lock-closed-outline"
                          class="text-xl text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300"></ion-icon>
              </div>
              <!-- Password input -->
              <input type="password"
                     id="currentPassword"
                     name="currentPassword"
                     required
                     autocomplete="current-password"
                     class="w-full pl-10 pr-12 py-3 bg-light-action-secondary dark:bg-dark-action-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-accent transition-all duration-300"
                     th:placeholder="#{admin.password.placeholder.current}">
              
              <!-- Password visibility toggle button -->
              <button type="button"
                      onclick="togglePassword('currentPassword', this)"
                      class="absolute inset-y-0 right-0 pr-3 flex items-center text-light-fg-tertiary hover:text-accent transition-colors duration-300">
                <ion-icon name="eye-outline" class="text-xl eye-icon"></ion-icon>
                <ion-icon name="eye-off-outline" class="text-xl eye-off-icon hidden"></ion-icon>
              </button>
            </div>
          </div>

          <!-- NEW PASSWORD FIELD -->
          <div>
            <label for="newPassword" class="block text-sm font-medium mb-2 transition-colors duration-300">
              <span th:text="#{admin.password.new}">New Password</span> <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <!-- Key icon -->
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <ion-icon name="key-outline"
                          class="text-xl text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300"></ion-icon>
              </div>
              <!-- New password input -->
              <input type="password"
                     id="newPassword"
                     name="newPassword"
                     required
                     autocomplete="new-password"
                     minlength="8"
                     class="w-full pl-10 pr-12 py-3 bg-light-action-secondary dark:bg-dark-action-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-accent transition-all duration-300"
                     th:placeholder="#{admin.password.placeholder.new}"
                     oninput="checkPasswordStrength(this.value)">
              
              <!-- Password visibility toggle button -->
              <button type="button"
                      onclick="togglePassword('newPassword', this)"
                      class="absolute inset-y-0 right-0 pr-3 flex items-center text-light-fg-tertiary hover:text-accent transition-colors duration-300">
                <ion-icon name="eye-outline" class="text-xl eye-icon"></ion-icon>
                <ion-icon name="eye-off-outline" class="text-xl eye-off-icon hidden"></ion-icon>
              </button>
            </div>
            
            <!-- Password Strength Indicator (initially hidden) -->
            <div id="passwordStrength" class="mt-2 hidden">
              <div class="flex gap-1 mb-1">
                <div class="h-1 flex-1 rounded bg-light-action-secondary dark:bg-dark-action-secondary transition-colors duration-300" id="strength-1"></div>
                <div class="h-1 flex-1 rounded bg-light-action-secondary dark:bg-dark-action-secondary transition-colors duration-300" id="strength-2"></div>
                <div class="h-1 flex-1 rounded bg-light-action-secondary dark:bg-dark-action-secondary transition-colors duration-300" id="strength-3"></div>
                <div class="h-1 flex-1 rounded bg-light-action-secondary dark:bg-dark-action-secondary transition-colors duration-300" id="strength-4"></div>
              </div>
              <p class="text-xs transition-colors duration-300" id="strengthText" th:text="#{admin.password.strength.weak}">Weak password</p>
            </div>
          </div>

          <!-- CONFIRM NEW PASSWORD FIELD -->
          <div>
            <label for="confirmPassword" class="block text-sm font-medium mb-2 transition-colors duration-300">
              <span th:text="#{admin.password.confirm}">Confirm New Password</span> <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <!-- Key icon -->
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <ion-icon name="key-outline"
                          class="text-xl text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300"></ion-icon>
              </div>
              <!-- Confirm password input -->
              <input type="password"
                     id="confirmPassword"
                     name="confirmPassword"
                     required
                     autocomplete="new-password"
                     class="w-full pl-10 pr-12 py-3 bg-light-action-secondary dark:bg-dark-action-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-accent transition-all duration-300"
                     th:placeholder="#{admin.password.placeholder.confirm}"
                     oninput="checkPasswordMatch()">
              
              <!-- Password visibility toggle button -->
              <button type="button"
                      onclick="togglePassword('confirmPassword', this)"
                      class="absolute inset-y-0 right-0 pr-3 flex items-center text-light-fg-tertiary hover:text-accent transition-colors duration-300">
                <ion-icon name="eye-outline" class="text-xl eye-icon"></ion-icon>
                <ion-icon name="eye-off-outline" class="text-xl eye-off-icon hidden"></ion-icon>
              </button>
            </div>
            <!-- Password match indicator (initially hidden) -->
            <p id="passwordMatch" class="text-xs mt-1 hidden transition-colors duration-300"></p>
          </div>

          <!-- PASSWORD REQUIREMENTS CARD -->
          <div class="p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg transition-colors duration-300">
            <p class="text-sm font-medium mb-2 transition-colors duration-300" th:text="#{admin.password.requirements.title}">Password requirements:</p>
            <ul class="text-sm space-y-1 text-light-fg-secondary dark:text-dark-fg-secondary transition-colors duration-300">
              <li class="flex items-center gap-2">
                <ion-icon name="checkmark-circle" class="text-blue-500"></ion-icon>
                <span th:text="#{admin.password.requirements.length}">At least 8 characters</span>
              </li>
              <li class="flex items-center gap-2">
                <ion-icon name="checkmark-circle" class="text-blue-500"></ion-icon>
                <span th:text="#{admin.password.requirements.case}">Should contain uppercase and lowercase letters</span>
              </li>
              <li class="flex items-center gap-2">
                <ion-icon name="checkmark-circle" class="text-blue-500"></ion-icon>
                <span th:text="#{admin.password.requirements.numbers}">Should contain numbers</span>
              </li>
              <li class="flex items-center gap-2">
                <ion-icon name="checkmark-circle" class="text-blue-500"></ion-icon>
                <span th:text="#{admin.password.requirements.special}">Should contain special characters (!@#$%^&*)</span>
              </li>
            </ul>
          </div>

          <!-- FORM BUTTONS -->
          <div class="flex gap-4 pt-4">
            
            <!-- Submit button -->
            <button type="submit"
                    class="px-6 py-3 bg-accent text-white rounded-lg hover:bg-opacity-90 transition-all duration-300 inline-flex items-center gap-2">
              <ion-icon name="shield-checkmark-outline" class="text-xl"></ion-icon>
              <span th:text="#{admin.password.button.change}">Change Password</span>
            </button>
            
            <!-- Cancel button - returns to settings -->
            <a th:href="@{/admin/settings}"
               class="px-6 py-3 bg-light-action-secondary dark:bg-dark-action-secondary text-light-fg-secondary dark:text-dark-fg-secondary rounded-lg hover:bg-opacity-80 transition-all duration-300 inline-flex items-center gap-2">
              <ion-icon name="arrow-back-outline" class="text-xl"></ion-icon>
              <span th:text="#{admin.password.button.cancel}">Cancel</span>
            </a>
          </div>
        </form>
      </div>

      <!-- SECURITY TIPS CARD -->
      <div class="mt-6 p-4 bg-light-bg-primary dark:bg-dark-bg-primary rounded-xl shadow-md transition-colors duration-300">
        
        <!-- Card Header -->
        <h3 class="font-semibold mb-3 flex items-center gap-2 transition-colors duration-300">
          <ion-icon name="shield-outline" class="text-xl text-accent"></ion-icon>
          <span th:text="#{admin.password.tips.title}">Security Tips</span>
        </h3>
        
        <!-- Security Tips List -->
        <ul class="text-sm space-y-2 text-light-fg-secondary dark:text-dark-fg-secondary transition-colors duration-300">
          <li class="flex items-start gap-2">
            <ion-icon name="chevron-forward" class="text-accent mt-0.5"></ion-icon>
            <span th:text="#{admin.password.tips.unique}">Use a unique password and do not reuse old passwords</span>
          </li>
          <li class="flex items-start gap-2">
            <ion-icon name="chevron-forward" class="text-accent mt-0.5"></ion-icon>
            <span th:text="#{admin.password.tips.combine}">Combine uppercase, lowercase, numbers, and special characters</span>
          </li>
          <li class="flex items-start gap-2">
            <ion-icon name="chevron-forward" class="text-accent mt-0.5"></ion-icon>
            <span th:text="#{admin.password.tips.personal}">Avoid using easily guessed personal information</span>
          </li>
          <li class="flex items-start gap-2">
            <ion-icon name="chevron-forward" class="text-accent mt-0.5"></ion-icon>
            <span th:text="#{admin.password.tips.periodic}">Change your password periodically (every 3â€“6 months)</span>
          </li>
          <li class="flex items-start gap-2">
            <ion-icon name="chevron-forward" class="text-accent mt-0.5"></ion-icon>
            <span th:text="#{admin.password.tips.share}">Never share your password with anyone</span>
          </li>
        </ul>
      </div>
    </div>
  </section>
</div>

</body>
</html>