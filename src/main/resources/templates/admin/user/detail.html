<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout/main}">

<head>
  <title th:text="#{admin.user.detail.pageTitle}">
    User Details - Admin Panel
  </title>
</head>

<body>

<div layout:fragment="content">

  <!-- USER DETAIL SECTION -->
  <section th:fragment="page-content" id="section-user-detail" class="transition-colors duration-300">

    <!-- PAGE HEADER with Back Button -->
    <div class="flex items-center gap-3 mb-6">
      
      <!--
           HTMX: Back button to return to users list
           - hx-get       : GET request to load users list
           - hx-target    : Swap HTML into main content area
           - hx-push-url  : Update browser URL
           - hx-swap      : Replace entire content of target
      -->
      <a hx-get="/admin/users"
         hx-target="#main-content"
         hx-push-url="true"
         hx-swap="innerHTML"
         class="p-2 rounded-lg bg-light-action-secondary dark:bg-dark-action-secondary hover:bg-opacity-80 transition-all duration-300 cursor-pointer">
        <ion-icon name="arrow-back-outline" class="text-xl"></ion-icon>
      </a>
      
      <!-- Page title with user's full name -->
      <div>
        <h2 class="text-3xl font-bold transition-colors duration-300" th:text="#{admin.user.detail.title}">User Detail</h2>
        <p class="text-sm text-light-fg-secondary dark:text-dark-fg-secondary transition-colors duration-300 mt-1"
           th:text="#{admin.user.detail.viewingProfile(${user.firstname() + ' ' + user.lastname()})}">
          Viewing profile of <span class="font-medium">Full Name</span>
        </p>
      </div>
    </div>

    <!-- MAIN CONTENT CONTAINER -->
    <div class="max-w-4xl space-y-6">

      <!-- PROFILE CARD -->
      <div class="bg-light-bg-primary dark:bg-dark-bg-primary rounded-xl shadow-md overflow-hidden transition-colors duration-300">

        <!-- Cover Image with Gradient -->
        <div class="h-28 bg-gradient-to-r from-accent/80 to-accent relative">
          
          <!-- Action buttons (Edit & Delete) positioned top-right -->
          <div class="absolute top-3 right-3 flex gap-2">
            
            <!--
                 HTMX: Edit button - loads user edit form
                 th:hx-get builds dynamic URL with user ID
                 hx-target swaps content into main area
                 hx-push-url updates browser URL
            -->
            <a th:hx-get="@{/admin/users/{id}/update(id=${user.id()})}"
               hx-target="#main-content"
               hx-push-url="true"
               hx-swap="innerHTML"
               class="px-3 py-1.5 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-all duration-300 inline-flex items-center gap-1.5 text-sm font-medium backdrop-blur-sm cursor-pointer"
               th:title="#{admin.users.action.edit}">
              <ion-icon name="create-outline" class="text-base"></ion-icon>
              <span th:text="#{admin.users.action.edit}">Edit</span>
            </a>
            
            <!--
                 HTMX: Delete button - sends delete request for user
                 th:hx-post builds dynamic POST URL with user ID
                 hx-target swaps response into #main-content
                 hx-push-url updates browser URL after request
                 hx-swap replaces inner HTML of target
            --> 
            <button th:hx-post="@{/admin/users/{id}/delete(id=${user.id()})}"
                    hx-target="#main-content"
                    hx-push-url="true"
                    hx-swap="innerHTML"
                    class="px-3 py-1.5 bg-red-500/20 hover:bg-red-500/30 text-white rounded-lg transition-all duration-300 inline-flex items-center gap-1.5 text-sm font-medium backdrop-blur-sm cursor-pointer"
                    th:title="#{admin.users.action.delete}">
              <ion-icon name="trash-outline" class="text-base"></ion-icon>
              <span th:text="#{admin.users.action.delete}">Delete</span>
            </button>
          </div>
        </div>

        <!-- Avatar + Name Section -->
        <div class="px-6 pb-6">
          <div class="flex items-end gap-4 -mt-12 mb-4">
            
            <!-- User Avatar -->
            <div class="w-24 h-24 rounded-full overflow-hidden border-4 border-light-bg-primary dark:border-dark-bg-primary flex-shrink-0 bg-light-action-secondary dark:bg-dark-action-secondary transition-colors duration-300">
              
              <!-- If user has avatar, display it (base64 encoded) -->
              <img th:if="${user.avatar() != null}"
                   th:src="'data:image/png;base64,' + ${T(java.util.Base64).getEncoder().encodeToString(user.avatar().getBytes())}"
                   alt="avatar"
                   class="w-full h-full object-cover">
              
              <!-- If no avatar, show initials (first letter of firstname + lastname) -->
              <div th:if="${user.avatar() == null}"
                   class="w-full h-full flex items-center justify-center bg-accent text-white font-bold text-2xl">
                <span th:text="${#strings.substring(user.firstname(),0,1) + #strings.substring(user.lastname(),0,1)}">AB</span>
              </div>
            </div>
            
            <!-- User Name and Username -->
            <div class="pb-1">
              <h3 class="text-2xl font-bold transition-colors duration-300"
                  th:text="${user.firstname() + ' ' + user.lastname()}">Full Name</h3>
              <p class="text-sm text-light-fg-secondary dark:text-dark-fg-secondary transition-colors duration-300"
                 th:text="'@' + ${user.username()}">@username</p>
            </div>
          </div>

          <!-- User Headline (if available) -->
          <p th:if="${user.headline() != null and !#strings.isEmpty(user.headline())}"
             class="text-light-fg-secondary dark:text-dark-fg-secondary transition-colors duration-300 mb-3"
             th:text="${user.headline()}">Headline</p>

          <!-- User Bio (if available) with top border -->
          <p th:if="${user.bio() != null and !#strings.isEmpty(user.bio())}"
             class="text-sm text-light-fg-secondary dark:text-dark-fg-secondary transition-colors duration-300 leading-relaxed border-t border-light-action-secondary dark:border-dark-action-secondary pt-3"
             th:text="${user.bio()}">Bio</p>
        </div>
      </div>

      <!-- TWO COLUMN LAYOUT -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

        <!-- ACCOUNT INFORMATION CARD -->
        <div class="bg-light-bg-primary dark:bg-dark-bg-primary rounded-xl shadow-md p-6 transition-colors duration-300">
          
          <!-- Card Header -->
          <h4 class="font-semibold mb-4 flex items-center gap-2 transition-colors duration-300">
            <ion-icon name="person-circle-outline" class="text-xl text-accent"></ion-icon>
            <span th:text="#{admin.user.detail.accountInfo}">Account Information</span>
          </h4>
          
          <!-- Account Details List -->
          <dl class="space-y-3">

            <!-- Username -->
            <div class="flex items-start gap-3">
              <ion-icon name="at-outline" class="text-lg text-light-fg-tertiary dark:text-dark-fg-tertiary mt-0.5 flex-shrink-0 transition-colors duration-300"></ion-icon>
              <div>
                <dt class="text-xs text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300" th:text="#{admin.user.detail.username}">Username</dt>
                <dd class="font-mono text-sm mt-0.5 transition-colors duration-300" th:text="${user.username()}">username</dd>
              </div>
            </div>

            <!-- Email -->
            <div class="flex items-start gap-3">
              <ion-icon name="mail-outline" class="text-lg text-light-fg-tertiary dark:text-dark-fg-tertiary mt-0.5 flex-shrink-0 transition-colors duration-300"></ion-icon>
              <div>
                <dt class="text-xs text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300" th:text="#{admin.user.detail.email}">Email</dt>
                <dd class="text-sm mt-0.5 transition-colors duration-300" th:text="${user.email()}">email@example.com</dd>
              </div>
            </div>

            <!-- Phone Number (with fallback to em dash if empty) -->
            <div class="flex items-start gap-3">
              <ion-icon name="call-outline" class="text-lg text-light-fg-tertiary dark:text-dark-fg-tertiary mt-0.5 flex-shrink-0 transition-colors duration-300"></ion-icon>
              <div>
                <dt class="text-xs text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300" th:text="#{admin.user.detail.phone}">Phone</dt>
                <dd class="text-sm mt-0.5 transition-colors duration-300"
                    th:text="${user.phoneNumber() != null and !#strings.isEmpty(user.phoneNumber())} ? ${user.phoneNumber()} : '—'">—</dd>
              </div>
            </div>

            <!-- Gender (formatted: first letter uppercase, rest lowercase) -->
            <div class="flex items-start gap-3">
              <ion-icon name="male-female-outline" class="text-lg text-light-fg-tertiary dark:text-dark-fg-tertiary mt-0.5 flex-shrink-0 transition-colors duration-300"></ion-icon>
              <div>
                <dt class="text-xs text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300" th:text="#{admin.user.detail.gender}">Gender</dt>
                <dd class="text-sm mt-0.5 transition-colors duration-300"
                    th:text="${user.gender() != null and !#strings.isEmpty(user.gender())}
                              ? ${#strings.toLowerCase(#strings.substring(user.gender(),0,1)) + #strings.substring(#strings.toLowerCase(user.gender()),1)}
                              : '—'">—</dd>
              </div>
            </div>

            <!-- Date of Birth (if available) -->
            <div class="flex items-start gap-3" th:if="${user.dateOfBirth() != null}">
              <ion-icon name="calendar-outline" class="text-lg text-light-fg-tertiary dark:text-dark-fg-tertiary mt-0.5 flex-shrink-0 transition-colors duration-300"></ion-icon>
              <div>
                <dt class="text-xs text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300" th:text="#{admin.user.detail.dateOfBirth}">Date of Birth</dt>
                <dd class="text-sm mt-0.5 transition-colors duration-300" th:text="${#dates.format(user.dateOfBirth(), 'dd MMM yyyy')}">01 Jan 1990</dd>
              </div>
            </div>

            <!-- Location (City + Country if available) -->
            <div class="flex items-start gap-3" th:if="${user.city() != null and !#strings.isEmpty(user.city()) or user.country() != null and !#strings.isEmpty(user.country())}">
              <ion-icon name="location-outline" class="text-lg text-light-fg-tertiary dark:text-dark-fg-tertiary mt-0.5 flex-shrink-0 transition-colors duration-300"></ion-icon>
              <div>
                <dt class="text-xs text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300" th:text="#{admin.user.detail.location}">Location</dt>
                <dd class="text-sm mt-0.5 transition-colors duration-300"
                    th:text="${user.city() != null and !#strings.isEmpty(user.city())} ? ${user.city()} : '' 
                              + ${user.country() != null and !#strings.isEmpty(user.country())} ? (${user.city() != null and !#strings.isEmpty(user.city())} ? ', ' : '') + ${user.country()} : ''">
                  City, Country
                </dd>
              </div>
            </div>

            <!-- Member Since -->
            <div class="flex items-start gap-3" th:if="${user.createdAt() != null}">
              <ion-icon name="time-outline" class="text-lg text-light-fg-tertiary dark:text-dark-fg-tertiary mt-0.5 flex-shrink-0 transition-colors duration-300"></ion-icon>
              <div>
                <dt class="text-xs text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300" th:text="#{admin.user.detail.memberSince}">Member Since</dt>
                <dd class="text-sm mt-0.5 transition-colors duration-300" th:text="${#dates.format(user.createdAt(), 'dd MMM yyyy')}">01 Jan 2023</dd>
              </div>
            </div>

          </dl>
        </div>

        <!-- SOCIAL LINKS CARD -->
        <div class="bg-light-bg-primary dark:bg-dark-bg-primary rounded-xl shadow-md p-6 transition-colors duration-300">
          
          <!-- Card Header -->
          <h4 class="font-semibold mb-4 flex items-center gap-2 transition-colors duration-300">
            <ion-icon name="share-social-outline" class="text-xl text-accent"></ion-icon>
            <span th:text="#{admin.user.detail.socialLinks}">Social Links</span>
          </h4>

          <!-- Empty State: No social links -->
          <div th:if="${(user.githubUrl() == null or #strings.isEmpty(user.githubUrl()))
                    and (user.linkedinUrl() == null or #strings.isEmpty(user.linkedinUrl()))
                    and (user.xUrl() == null or #strings.isEmpty(user.xUrl()))
                    and (user.facebookUrl() == null or #strings.isEmpty(user.facebookUrl()))}"
               class="text-sm text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300"
               th:text="#{admin.user.detail.noSocialLinks}">
            No social links added yet.
          </div>

          <!-- Social Links Grid -->
          <div class="grid grid-cols-1 gap-3">

            <!-- GitHub Link (if available) -->
            <a th:if="${user.githubUrl() != null and !#strings.isEmpty(user.githubUrl())}"
               th:href="${user.githubUrl()}"
               target="_blank" rel="noopener noreferrer"
               class="flex items-center gap-3 p-3 rounded-lg bg-light-action-secondary dark:bg-dark-action-secondary hover:text-accent transition-all duration-300 group">
              <ion-icon name="logo-github" class="text-2xl flex-shrink-0"></ion-icon>
              <div class="overflow-hidden">
                <p class="text-xs text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300">GitHub</p>
                <p class="text-sm truncate group-hover:text-accent transition-colors duration-300" th:text="${user.githubUrl()}">https://github.com/username</p>
              </div>
              <ion-icon name="open-outline" class="text-base ml-auto flex-shrink-0 opacity-0 group-hover:opacity-100 transition-all duration-300"></ion-icon>
            </a>

            <!-- LinkedIn Link (if available) -->
            <a th:if="${user.linkedinUrl() != null and !#strings.isEmpty(user.linkedinUrl())}"
               th:href="${user.linkedinUrl()}"
               target="_blank" rel="noopener noreferrer"
               class="flex items-center gap-3 p-3 rounded-lg bg-light-action-secondary dark:bg-dark-action-secondary hover:text-accent transition-all duration-300 group">
              <ion-icon name="logo-linkedin" class="text-2xl flex-shrink-0"></ion-icon>
              <div class="overflow-hidden">
                <p class="text-xs text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300">LinkedIn</p>
                <p class="text-sm truncate group-hover:text-accent transition-colors duration-300" th:text="${user.linkedinUrl()}">https://linkedin.com/in/username</p>
              </div>
              <ion-icon name="open-outline" class="text-base ml-auto flex-shrink-0 opacity-0 group-hover:opacity-100 transition-all duration-300"></ion-icon>
            </a>

            <!-- X (Twitter) Link (if available) -->
            <a th:if="${user.xUrl() != null and !#strings.isEmpty(user.xUrl())}"
               th:href="${user.xUrl()}"
               target="_blank" rel="noopener noreferrer"
               class="flex items-center gap-3 p-3 rounded-lg bg-light-action-secondary dark:bg-dark-action-secondary hover:text-accent transition-all duration-300 group">
              <ion-icon name="logo-twitter" class="text-2xl flex-shrink-0"></ion-icon>
              <div class="overflow-hidden">
                <p class="text-xs text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300">X (Twitter)</p>
                <p class="text-sm truncate group-hover:text-accent transition-colors duration-300" th:text="${user.xUrl()}">https://x.com/username</p>
              </div>
              <ion-icon name="open-outline" class="text-base ml-auto flex-shrink-0 opacity-0 group-hover:opacity-100 transition-all duration-300"></ion-icon>
            </a>

            <!-- Facebook Link (if available) -->
            <a th:if="${user.facebookUrl() != null and !#strings.isEmpty(user.facebookUrl())}"
               th:href="${user.facebookUrl()}"
               target="_blank" rel="noopener noreferrer"
               class="flex items-center gap-3 p-3 rounded-lg bg-light-action-secondary dark:bg-dark-action-secondary hover:text-accent transition-all duration-300 group">
              <ion-icon name="logo-facebook" class="text-2xl flex-shrink-0"></ion-icon>
              <div class="overflow-hidden">
                <p class="text-xs text-light-fg-tertiary dark:text-dark-fg-tertiary transition-colors duration-300">Facebook</p>
                <p class="text-sm truncate group-hover:text-accent transition-colors duration-300" th:text="${user.facebookUrl()}">https://facebook.com/username</p>
              </div>
              <ion-icon name="open-outline" class="text-base ml-auto flex-shrink-0 opacity-0 group-hover:opacity-100 transition-all duration-300"></ion-icon>
            </a>

          </div>
        </div>
      </div>
    </div>
  </section>

</div>

</body>
</html>